<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Hadoop/MapReduce/Shuffle机制">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<title data-rh="true">Shuffle机制 | jellyrain笔记小站</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://jellyrain.github.io/learn/Hadoop/MapReduce/Shuffle机制"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Shuffle机制 | jellyrain笔记小站"><meta data-rh="true" name="description" content="Map方法之后，Reduce方法之前 的数据处理过程称之为 Shuffle"><meta data-rh="true" property="og:description" content="Map方法之后，Reduce方法之前 的数据处理过程称之为 Shuffle"><link data-rh="true" rel="icon" href="/learn/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://jellyrain.github.io/learn/Hadoop/MapReduce/Shuffle机制"><link data-rh="true" rel="alternate" href="https://jellyrain.github.io/learn/Hadoop/MapReduce/Shuffle机制" hreflang="en"><link data-rh="true" rel="alternate" href="https://jellyrain.github.io/learn/Hadoop/MapReduce/Shuffle机制" hreflang="x-default"><link rel="stylesheet" href="/learn/assets/css/styles.b2a6bbef.css">
<link rel="preload" href="/learn/assets/js/runtime~main.ae949c77.js" as="script">
<link rel="preload" href="/learn/assets/js/main.4b3cdc8a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/learn/"><div class="navbar__logo"><img src="/learn/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/learn/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Jellyrain</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/learn/">文档</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/jellyrain" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/learn/">介绍</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learn/DBeaver/DBeaver快捷键">DBeaver</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learn/DataBase/数据仓库/数据仓库概述">DataBase</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/learn/Hadoop/Hadoop简介">Hadoop</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learn/Hadoop/Hadoop简介">Hadoop简介</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learn/Hadoop/Hadoop搭建">Hadoop搭建</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learn/Hadoop/Hadoop完全分布式搭建">Hadoop完全分布式搭建</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learn/Hadoop/Hadoop常用脚本">Hadoop常用脚本</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/learn/Hadoop/HDFS/HDFS概述">HDFS</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/learn/Hadoop/MapReduce/MapReduce概述">MapReduce</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/learn/Hadoop/MapReduce/MapReduce概述">MapReduce概述</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/learn/Hadoop/MapReduce/WordCount案例">WordCount案例</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/learn/Hadoop/MapReduce/Hadoop序列化">Hadoop序列化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/learn/Hadoop/MapReduce/InputFormat数据输入">InputFormat数据输入</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/learn/Hadoop/MapReduce/MapReduce工作流程">MapReduce工作流程</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/learn/Hadoop/MapReduce/Shuffle机制">Shuffle机制</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/learn/Hadoop/MapReduce/OutputFormat数据输出">OutputFormat数据输出</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/learn/Hadoop/MapReduce/MapReduce内核解析">MapReduce内核解析</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/learn/Hadoop/MapReduce/Join应用">Join应用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/learn/Hadoop/MapReduce/MapReduce ETL用法">MapReduce ETL用法</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/learn/Hadoop/MapReduce/MapReduce开发总结">MapReduce开发总结</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/learn/Hadoop/MapReduce/Hadoop数据压缩">Hadoop数据压缩</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/learn/Hadoop/Yarn/Yarn概述">Yarn</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/learn/Hadoop/生产调优/HDFS 核心参数">生产调优</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learn/Hive/Hive概述">Hive</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learn/Java/Maven/简介">Java</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learn/Linux&amp;Shell/Linux/Linux概述">Linux&amp;Shell</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learn/Markdown/Markdown 基本语法">Markdown</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learn/SQL/DCL/grant">SQL</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learn/XPath/XPath（基础）">XPath</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learn/Zookeeper/Zookeeper概述">Zookeeper</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learn/web/HTML/HTML 介绍">web</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learn/正则表达式/正则表达式（基础）">正则表达式</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learn/计算机网络/软件结构">计算机网络</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/learn/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Hadoop</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">MapReduce</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Shuffle机制</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Shuffle机制</h1></header><p><strong>Map方法之后，Reduce方法之前 </strong>的数据处理过程称之为 <strong>Shuffle</strong></p><p><img loading="lazy" src="/learn/assets/images/Snipaste_2022-04-22_14-22-48-aa9a3658ae5958b25b6f336f4e392806.png" width="1343" height="667" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-partitioner-分区">1. Partitioner 分区：<a class="hash-link" href="#1-partitioner-分区" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-默认分区逻辑">1. 默认分区逻辑：<a class="hash-link" href="#1-默认分区逻辑" title="Direct link to heading">​</a></h3><p><img loading="lazy" src="/learn/assets/images/Snipaste_2022-04-22_14-45-50-340a650278da3d9b0c963c41fc85bea4.png" width="1019" height="214" class="img_ev3q"></p><p>默认分区是根据 <strong>key</strong> 的 <strong>hashCode</strong>（<strong>和 int 最大值 二进制与操作</strong>） 对 <strong>ReduceTasks</strong> 个数取模得到的，用户无法控制哪一个key存储到哪一个分区</p><p>默认分区特点：</p><ol><li>如果 <strong>ReduceTask 的数量 &gt; getPartition 的结果数</strong>，则会多产生几个空的输出文件 part-r-000xx</li><li>如果 <strong>1 &lt; ReduceTask 的数量 &lt; getPartition 的结果数</strong>，则有一部分分区数据无处安放，会 <strong>Exception</strong></li><li>如果 <strong>ReduceTask 的数量 = 1</strong>，则不管 MapTask 端输出多少个分区文件，最终结果都交给这一个 ReduceTask，最终也就只会产生一个结果文件 part-r-00000</li><li>分区号必须从零开始，逐一累加</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-自定义-partitioner-分区逻辑">2. 自定义 Partitioner 分区逻辑：<a class="hash-link" href="#2-自定义-partitioner-分区逻辑" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-自定义类继承-partitioner-类重写getpartition方法">1. 自定义类继承 Partitioner 类，重写getPartition()方法：<a class="hash-link" href="#1-自定义类继承-partitioner-类重写getpartition方法" title="Direct link to heading">​</a></h4><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class CustomPartitioner extends Partitioner&lt;Text, FlowBean&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int getPartition(Text key, FlowBean value, int numPartitions) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          // 控制分区代码逻辑</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            … …</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return partition;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-在-job-驱动中设置自定义-partitioner-类">2. 在 Job 驱动中，设置自定义 Partitioner 类：<a class="hash-link" href="#2-在-job-驱动中设置自定义-partitioner-类" title="Direct link to heading">​</a></h4><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">job.setPartitionerClass(CustomPartitioner.class);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-要根据自定义-partitioner-的逻辑设置相应数量的-reducetask">3. 要根据自定义 Partitioner 的逻辑设置相应数量的 ReduceTask：<a class="hash-link" href="#3-要根据自定义-partitioner-的逻辑设置相应数量的-reducetask" title="Direct link to heading">​</a></h4><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">job.setNumReduceTasks(5); // 开5个 ReduceTask</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-writablecomparable-排序">2. WritableComparable 排序：<a class="hash-link" href="#2-writablecomparable-排序" title="Direct link to heading">​</a></h2><ol><li><p>排序是MapReduce框架中最重要的操作之一</p></li><li><p>MapTask 和 ReduceTask 均会对数据按照 key 进行排序。该操作属于 Hadoop 的<strong>默认行为</strong>。任何应用程序中的数据均会被排序，而不管逻辑上是否需要（为了快速 导入 <strong>Reduce</strong>）。</p></li><li><p>默认排序是按照 <strong>字典顺序排序</strong>，且实现该排序的方法是 <strong>快速排序</strong>。</p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-maptask">1. MapTask：<a class="hash-link" href="#1-maptask" title="Direct link to heading">​</a></h3><p>它会将处理的结果暂时放到环形缓冲区中，<strong>当环形缓冲区使用率达到一定阈值后，再对缓冲区中的数据进行一次快速排序（在内存中排序）</strong>，并将这些有序数据溢写到磁盘上，而当数据处理完毕后，它会<strong>对磁盘上所有文件进行归并排序</strong></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-reducetask">2. ReduceTask：<a class="hash-link" href="#2-reducetask" title="Direct link to heading">​</a></h3><p>它从每个MapTask上远程拷贝相应的数据文件，<strong>如果文件大小超过一定阈值，则溢写磁盘上，否则存储在内存中</strong>。如果磁盘上文件数目达到一定阈值，则进行一次归并排序以生成一个更大文件；如果内存中文件大小或者数目超过一定阈值，则进行一次合并后将数据溢写到磁盘上。当所有数据拷贝完毕后，<strong>ReduceTask统一对内存和磁盘上的所有数据进行一次归并排序</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-combiner-合并">3. Combiner 合并：<a class="hash-link" href="#3-combiner-合并" title="Direct link to heading">​</a></h2><ol><li>Combiner 是 MR程序中 Mapper 和 Reducer 之外的一种组件</li><li>Combiner 组件的父类就是 <strong>Reducer</strong></li><li>Combiner 和 Reducer 的区别在于运行的位置：<ol><li>Combiner是在 <strong>每一个</strong> <strong>MapTask所在的节点</strong> 运行</li><li>Reducer 是接收<strong>全局</strong>所有 Mapper 的输出结果</li></ol></li><li>Combiner的意义就是对每一个MapTask的输出进行局部汇总，以<strong>减小网络传输量</strong></li><li>Combiner能够应用的前提是<strong>不能影响最终的业务逻辑</strong>，而且，Combiner的输出kv 应该跟Reducer的输入kv 类型要对应起来</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-实战案例">4. 实战案例：<a class="hash-link" href="#4-实战案例" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-partitioner-分区只写添加部分-其他在上一节查找">1. Partitioner 分区（只写添加部分 其他在上一节查找）：<a class="hash-link" href="#1-partitioner-分区只写添加部分-其他在上一节查找" title="Direct link to heading">​</a></h3><ol><li>分区类写法：</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.jelllyrain.mapreduce.partitioner;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.io.Text;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.mapreduce.Partitioner;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ProvincePartitioner extends Partitioner&lt;Text, FlowBean&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int getPartition(Text text, FlowBean flowBean, int numPartitions) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //获取手机号前三位prePhone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String phone = text.toString();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String prePhone = phone.substring(0, 3);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //定义一个分区号变量partition,根据prePhone设置分区号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int partition;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if(&quot;136&quot;.equals(prePhone)){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            partition = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }else if(&quot;137&quot;.equals(prePhone)){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            partition = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }else if(&quot;138&quot;.equals(prePhone)){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            partition = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }else if(&quot;139&quot;.equals(prePhone)){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            partition = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            partition = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //最后返回分区号partition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return partition;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>在驱动函数中增加自定义数据分区设置和ReduceTask设置（新版 Driver 文件）：</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.jelllyrain.mapreduce.partitioner;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.conf.Configuration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.fs.Path;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.io.Text;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.mapreduce.Job;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.IOException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class FlowDriver {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //1 获取job对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Configuration conf = new Configuration();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Job job = Job.getInstance(conf);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //2 关联本Driver类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job.setJarByClass(FlowDriver.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //3 关联Mapper和Reducer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job.setMapperClass(FlowMapper.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job.setReducerClass(FlowReducer.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //4 设置Map端输出数据的KV类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job.setMapOutputKeyClass(Text.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job.setMapOutputValueClass(FlowBean.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //5 设置程序最终输出的KV类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job.setOutputKeyClass(Text.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job.setOutputValueClass(FlowBean.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //8 指定自定义分区器（新添加）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job.setPartitionerClass(ProvincePartitioner.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //9 同时指定相应数量的ReduceTask（新添加）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job.setNumReduceTasks(5);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //6 设置输入输出路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FileInputFormat.setInputPaths(job, new Path(&quot;D:\\inputflow&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FileOutputFormat.setOutputPath(job, new Path(&quot;D\\partitionout&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //7 提交Job</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        boolean b = job.waitForCompletion(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.exit(b ? 0 : 1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-writablecomparable-排序区内排序">2. WritableComparable 排序（区内排序）：<a class="hash-link" href="#2-writablecomparable-排序区内排序" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-需求">1. 需求：<a class="hash-link" href="#1-需求" title="Direct link to heading">​</a></h4><ol><li>输入数据：</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1   13736230513 192.196.100.1   www.atguigu.com 2481    24681   200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2   13846544121 192.196.100.2           264 0   200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3   13956435636 192.196.100.3           132 1512    200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4   13966251146 192.168.100.1           240 0   404</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5   18271575951 192.168.100.2   www.atguigu.com 1527    2106    200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6   84188413    192.168.100.3   www.atguigu.com 4116    1432    200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">7   13590439668 192.168.100.4           1116    954 200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8   15910133277 192.168.100.5   www.hao123.com  3156    2936    200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">9   13729199489 192.168.100.6           240 0   200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10  13630577991 192.168.100.7   www.shouhu.com  6960    690 200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">11  15043685818 192.168.100.8   www.baidu.com   3659    3538    200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">12  15959002129 192.168.100.9   www.atguigu.com 1938    180 500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">13  13560439638 192.168.100.10          918 4938    200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">14  13470253144 192.168.100.11          180 180 200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">15  13682846555 192.168.100.12  www.qq.com  1938    2910    200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">16  13992314666 192.168.100.13  www.gaga.com    3008    3720    200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">17  13509468723 192.168.100.14  www.qinghua.com 7335    110349  404</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">18  18390173782 192.168.100.15  www.sogou.com   9531    2412    200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">19  13975057813 192.168.100.16  www.baidu.com   11058   48243   200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">20  13768778790 192.168.100.17          120 120 200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">21  13568436656 192.168.100.18  www.alibaba.com 2481    24681   200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">22  13568436656 192.168.100.19          1116    954 200</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>输出数据：</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">13509468723 7335    110349  117684</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">13736230513 2481    24681   27162</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">13956435636 132     1512    1644</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">13846544121 264     0       264</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">。。。 。。。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-实现">2. 实现：<a class="hash-link" href="#2-实现" title="Direct link to heading">​</a></h4><ol><li>FlowBean 对象 换成继承 WritableComparable：</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.jellyrain.mapreduce.writablecompable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.io.WritableComparable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.DataInput;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.DataOutput;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.IOException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class FlowBean implements WritableComparable&lt;FlowBean&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private long upFlow; //上行流量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private long downFlow; //下行流量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private long sumFlow; //总流量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //提供无参构造</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public FlowBean() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //生成三个属性的getter和setter方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public long getUpFlow() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return upFlow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setUpFlow(long upFlow) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.upFlow = upFlow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public long getDownFlow() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return downFlow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setDownFlow(long downFlow) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.downFlow = downFlow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public long getSumFlow() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return sumFlow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setSumFlow(long sumFlow) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.sumFlow = sumFlow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setSumFlow() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.sumFlow = this.upFlow + this.downFlow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //实现序列化和反序列化方法,注意顺序一定要一致</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void write(DataOutput out) throws IOException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        out.writeLong(this.upFlow);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        out.writeLong(this.downFlow);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        out.writeLong(this.sumFlow);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void readFields(DataInput in) throws IOException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.upFlow = in.readLong();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.downFlow = in.readLong();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.sumFlow = in.readLong();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //重写ToString,最后要输出FlowBean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String toString() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return upFlow + &quot;\t&quot; + downFlow + &quot;\t&quot; + sumFlow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override // 排序核心代码 重写 compareTo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int compareTo(FlowBean o) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //按照总流量比较,倒序排列</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if(this.sumFlow &gt; o.sumFlow){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }else if(this.sumFlow &lt; o.sumFlow){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>编写 <strong>Mapper</strong> 类：</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.jellyrain.mapreduce.writablecompable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.io.LongWritable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.io.Text;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.mapreduce.Mapper;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.IOException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class FlowMapper extends Mapper&lt;LongWritable, Text, FlowBean, Text&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private FlowBean outK = new FlowBean();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Text outV = new Text();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //1 获取一行数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String line = value.toString();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //2 按照&quot;\t&quot;,切割数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String[] split = line.split(&quot;\t&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //3 封装outK outV</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        outK.setUpFlow(Long.parseLong(split[1]));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        outK.setDownFlow(Long.parseLong(split[2]));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        outK.setSumFlow();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        outV.set(split[0]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //4 写出outK outV</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        context.write(outK,outV);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>编写 <strong>Reducer</strong> 类：</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.jellyrain.mapreduce.writablecompable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.io.Text;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.mapreduce.Reducer;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.IOException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class FlowReducer extends Reducer&lt;FlowBean, Text, Text, FlowBean&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected void reduce(FlowBean key, Iterable&lt;Text&gt; values, Context context) throws IOException, InterruptedException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //遍历values集合,循环写出,避免总流量相同的情况</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (Text value : values) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //调换KV位置,反向写出</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            context.write(value,key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>编写 <strong>Driver</strong> 类：</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.jellyrain.mapreduce.writablecompable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.conf.Configuration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.fs.Path;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.io.Text;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.mapreduce.Job;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.IOException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class FlowDriver {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //1 获取job对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Configuration conf = new Configuration();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Job job = Job.getInstance(conf);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //2 关联本Driver类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job.setJarByClass(FlowDriver.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //3 关联Mapper和Reducer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job.setMapperClass(FlowMapper.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job.setReducerClass(FlowReducer.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //4 设置Map端输出数据的KV类型（由于使用FlowBean排序，且只能是key排序，所以和以前的顺序相反）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job.setMapOutputKeyClass(FlowBean.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job.setMapOutputValueClass(Text.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //5 设置程序最终输出的KV类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job.setOutputKeyClass(Text.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        job.setOutputValueClass(FlowBean.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //6 设置输入输出路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FileInputFormat.setInputPaths(job, new Path(&quot;D:\\inputflow2&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FileOutputFormat.setOutputPath(job, new Path(&quot;D:\\comparout&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //7 提交Job</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        boolean b = job.waitForCompletion(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.exit(b ? 0 : 1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="5"><li>区内排序：</li></ol><p>参考 <strong>Partitioner 分区</strong> 案例，编写，泛型是 <code>FlowBean, Text</code> （由于使用FlowBean排序，且只能是key排序，所以和以前的顺序相反）</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-combiner-合并只写添加部分-其他在上一节查找">3. Combiner 合并（只写添加部分 其他在上一节查找）：<a class="hash-link" href="#3-combiner-合并只写添加部分-其他在上一节查找" title="Direct link to heading">​</a></h3><ol><li>增加一个 WordCountCombiner 类继承 Reducer：</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.jellyrain.mapreduce.combiner;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.io.IntWritable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.io.Text;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.hadoop.mapreduce.Reducer;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.IOException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class WordCountCombiner extends Reducer&lt;Text, IntWritable, Text, IntWritable&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">private IntWritable outV = new IntWritable();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected void reduce(Text key, Iterable&lt;IntWritable&gt; values, Context context) throws IOException, InterruptedException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int sum = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (IntWritable value : values) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sum += value.get();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //封装outKV</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        outV.set(sum);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //写出outKV</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        context.write(key,outV);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>在 WordcountDriver 驱动类中指定 Combiner：</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 指定需要使用combiner，以及用哪个类作为combiner的逻辑</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">job.setCombinerClass(WordCountCombiner.class);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>或者</strong></p><ol><li>将 <strong>WordcountReducer</strong> 作为 <strong>Combiner</strong> 在 <strong>WordcountDriver</strong> 驱动类中指定：</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 指定需要使用combiner，以及用哪个类作为combiner的逻辑</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">job.setCombinerClass(WordCountReducer.class);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/learn/Hadoop/MapReduce/MapReduce工作流程"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">MapReduce工作流程</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/learn/Hadoop/MapReduce/OutputFormat数据输出"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">OutputFormat数据输出</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-partitioner-分区" class="table-of-contents__link toc-highlight">1. Partitioner 分区：</a><ul><li><a href="#1-默认分区逻辑" class="table-of-contents__link toc-highlight">1. 默认分区逻辑：</a></li><li><a href="#2-自定义-partitioner-分区逻辑" class="table-of-contents__link toc-highlight">2. 自定义 Partitioner 分区逻辑：</a></li></ul></li><li><a href="#2-writablecomparable-排序" class="table-of-contents__link toc-highlight">2. WritableComparable 排序：</a><ul><li><a href="#1-maptask" class="table-of-contents__link toc-highlight">1. MapTask：</a></li><li><a href="#2-reducetask" class="table-of-contents__link toc-highlight">2. ReduceTask：</a></li></ul></li><li><a href="#3-combiner-合并" class="table-of-contents__link toc-highlight">3. Combiner 合并：</a></li><li><a href="#4-实战案例" class="table-of-contents__link toc-highlight">4. 实战案例：</a><ul><li><a href="#1-partitioner-分区只写添加部分-其他在上一节查找" class="table-of-contents__link toc-highlight">1. Partitioner 分区（只写添加部分 其他在上一节查找）：</a></li><li><a href="#2-writablecomparable-排序区内排序" class="table-of-contents__link toc-highlight">2. WritableComparable 排序（区内排序）：</a></li><li><a href="#3-combiner-合并只写添加部分-其他在上一节查找" class="table-of-contents__link toc-highlight">3. Combiner 合并（只写添加部分 其他在上一节查找）：</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/learn/assets/js/runtime~main.ae949c77.js"></script>
<script src="/learn/assets/js/main.4b3cdc8a.js"></script>
</body>
</html>