"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1813],{3905:function(e,t,n){n.d(t,{Zo:function(){return s},kt:function(){return d}});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=a.createContext({}),u=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},s=function(e){var t=u(e.components);return a.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,p=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),m=u(n),d=o,k=m["".concat(p,".").concat(d)]||m[d]||c[d]||r;return n?a.createElement(k,i(i({ref:t},s),{},{components:n})):a.createElement(k,i({ref:t},s))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=m;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var u=2;u<r;u++)i[u]=n[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},92890:function(e,t,n){n.r(t),n.d(t,{assets:function(){return s},contentTitle:function(){return p},default:function(){return d},frontMatter:function(){return l},metadata:function(){return u},toc:function(){return c}});var a=n(83117),o=n(80102),r=(n(67294),n(3905)),i=["components"],l={sidebar_position:6},p=void 0,u={unversionedId:"Hadoop/MapReduce/Shuffle\u673a\u5236",id:"Hadoop/MapReduce/Shuffle\u673a\u5236",title:"Shuffle\u673a\u5236",description:"Map\u65b9\u6cd5\u4e4b\u540e\uff0cReduce\u65b9\u6cd5\u4e4b\u524d \u7684\u6570\u636e\u5904\u7406\u8fc7\u7a0b\u79f0\u4e4b\u4e3a Shuffle",source:"@site/docs\\7-Hadoop\\6-MapReduce\\Shuffle\u673a\u5236.md",sourceDirName:"7-Hadoop/6-MapReduce",slug:"/Hadoop/MapReduce/Shuffle\u673a\u5236",permalink:"/learn/Hadoop/MapReduce/Shuffle\u673a\u5236",draft:!1,tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"MapReduce\u5de5\u4f5c\u6d41\u7a0b",permalink:"/learn/Hadoop/MapReduce/MapReduce\u5de5\u4f5c\u6d41\u7a0b"},next:{title:"OutputFormat\u6570\u636e\u8f93\u51fa",permalink:"/learn/Hadoop/MapReduce/OutputFormat\u6570\u636e\u8f93\u51fa"}},s={},c=[{value:"1. Partitioner \u5206\u533a\uff1a",id:"1-partitioner-\u5206\u533a",level:2},{value:"1. \u9ed8\u8ba4\u5206\u533a\u903b\u8f91\uff1a",id:"1-\u9ed8\u8ba4\u5206\u533a\u903b\u8f91",level:3},{value:"2. \u81ea\u5b9a\u4e49 Partitioner \u5206\u533a\u903b\u8f91\uff1a",id:"2-\u81ea\u5b9a\u4e49-partitioner-\u5206\u533a\u903b\u8f91",level:3},{value:"1. \u81ea\u5b9a\u4e49\u7c7b\u7ee7\u627f Partitioner \u7c7b\uff0c\u91cd\u5199getPartition()\u65b9\u6cd5\uff1a",id:"1-\u81ea\u5b9a\u4e49\u7c7b\u7ee7\u627f-partitioner-\u7c7b\u91cd\u5199getpartition\u65b9\u6cd5",level:4},{value:"2. \u5728 Job \u9a71\u52a8\u4e2d\uff0c\u8bbe\u7f6e\u81ea\u5b9a\u4e49 Partitioner \u7c7b\uff1a",id:"2-\u5728-job-\u9a71\u52a8\u4e2d\u8bbe\u7f6e\u81ea\u5b9a\u4e49-partitioner-\u7c7b",level:4},{value:"3. \u8981\u6839\u636e\u81ea\u5b9a\u4e49 Partitioner \u7684\u903b\u8f91\u8bbe\u7f6e\u76f8\u5e94\u6570\u91cf\u7684 ReduceTask\uff1a",id:"3-\u8981\u6839\u636e\u81ea\u5b9a\u4e49-partitioner-\u7684\u903b\u8f91\u8bbe\u7f6e\u76f8\u5e94\u6570\u91cf\u7684-reducetask",level:4},{value:"2. WritableComparable \u6392\u5e8f\uff1a",id:"2-writablecomparable-\u6392\u5e8f",level:2},{value:"1. MapTask\uff1a",id:"1-maptask",level:3},{value:"2. ReduceTask\uff1a",id:"2-reducetask",level:3},{value:"3. Combiner \u5408\u5e76\uff1a",id:"3-combiner-\u5408\u5e76",level:2},{value:"4. \u5b9e\u6218\u6848\u4f8b\uff1a",id:"4-\u5b9e\u6218\u6848\u4f8b",level:2},{value:"1. Partitioner \u5206\u533a\uff08\u53ea\u5199\u6dfb\u52a0\u90e8\u5206 \u5176\u4ed6\u5728\u4e0a\u4e00\u8282\u67e5\u627e\uff09\uff1a",id:"1-partitioner-\u5206\u533a\u53ea\u5199\u6dfb\u52a0\u90e8\u5206-\u5176\u4ed6\u5728\u4e0a\u4e00\u8282\u67e5\u627e",level:3},{value:"2. WritableComparable \u6392\u5e8f\uff08\u533a\u5185\u6392\u5e8f\uff09\uff1a",id:"2-writablecomparable-\u6392\u5e8f\u533a\u5185\u6392\u5e8f",level:3},{value:"1. \u9700\u6c42\uff1a",id:"1-\u9700\u6c42",level:4},{value:"2. \u5b9e\u73b0\uff1a",id:"2-\u5b9e\u73b0",level:4},{value:"3. Combiner \u5408\u5e76\uff08\u53ea\u5199\u6dfb\u52a0\u90e8\u5206 \u5176\u4ed6\u5728\u4e0a\u4e00\u8282\u67e5\u627e\uff09\uff1a",id:"3-combiner-\u5408\u5e76\u53ea\u5199\u6dfb\u52a0\u90e8\u5206-\u5176\u4ed6\u5728\u4e0a\u4e00\u8282\u67e5\u627e",level:3}],m={toc:c};function d(e){var t=e.components,l=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},m,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Map\u65b9\u6cd5\u4e4b\u540e\uff0cReduce\u65b9\u6cd5\u4e4b\u524d "),"\u7684\u6570\u636e\u5904\u7406\u8fc7\u7a0b\u79f0\u4e4b\u4e3a ",(0,r.kt)("strong",{parentName:"p"},"Shuffle")),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(59575).Z,width:"1343",height:"667"})),(0,r.kt)("h2",{id:"1-partitioner-\u5206\u533a"},"1. Partitioner \u5206\u533a\uff1a"),(0,r.kt)("h3",{id:"1-\u9ed8\u8ba4\u5206\u533a\u903b\u8f91"},"1. \u9ed8\u8ba4\u5206\u533a\u903b\u8f91\uff1a"),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(2043).Z,width:"1019",height:"214"})),(0,r.kt)("p",null,"\u9ed8\u8ba4\u5206\u533a\u662f\u6839\u636e ",(0,r.kt)("strong",{parentName:"p"},"key")," \u7684 ",(0,r.kt)("strong",{parentName:"p"},"hashCode"),"\uff08",(0,r.kt)("strong",{parentName:"p"},"\u548c int \u6700\u5927\u503c \u4e8c\u8fdb\u5236\u4e0e\u64cd\u4f5c"),"\uff09 \u5bf9 ",(0,r.kt)("strong",{parentName:"p"},"ReduceTasks")," \u4e2a\u6570\u53d6\u6a21\u5f97\u5230\u7684\uff0c\u7528\u6237\u65e0\u6cd5\u63a7\u5236\u54ea\u4e00\u4e2akey\u5b58\u50a8\u5230\u54ea\u4e00\u4e2a\u5206\u533a"),(0,r.kt)("p",null,"\u9ed8\u8ba4\u5206\u533a\u7279\u70b9\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u5982\u679c ",(0,r.kt)("strong",{parentName:"li"},"ReduceTask \u7684\u6570\u91cf > getPartition \u7684\u7ed3\u679c\u6570"),"\uff0c\u5219\u4f1a\u591a\u4ea7\u751f\u51e0\u4e2a\u7a7a\u7684\u8f93\u51fa\u6587\u4ef6 part-r-000xx"),(0,r.kt)("li",{parentName:"ol"},"\u5982\u679c ",(0,r.kt)("strong",{parentName:"li"},"1 < ReduceTask \u7684\u6570\u91cf < getPartition \u7684\u7ed3\u679c\u6570"),"\uff0c\u5219\u6709\u4e00\u90e8\u5206\u5206\u533a\u6570\u636e\u65e0\u5904\u5b89\u653e\uff0c\u4f1a ",(0,r.kt)("strong",{parentName:"li"},"Exception")),(0,r.kt)("li",{parentName:"ol"},"\u5982\u679c ",(0,r.kt)("strong",{parentName:"li"},"ReduceTask \u7684\u6570\u91cf = 1"),"\uff0c\u5219\u4e0d\u7ba1 MapTask \u7aef\u8f93\u51fa\u591a\u5c11\u4e2a\u5206\u533a\u6587\u4ef6\uff0c\u6700\u7ec8\u7ed3\u679c\u90fd\u4ea4\u7ed9\u8fd9\u4e00\u4e2a ReduceTask\uff0c\u6700\u7ec8\u4e5f\u5c31\u53ea\u4f1a\u4ea7\u751f\u4e00\u4e2a\u7ed3\u679c\u6587\u4ef6 part-r-00000"),(0,r.kt)("li",{parentName:"ol"},"\u5206\u533a\u53f7\u5fc5\u987b\u4ece\u96f6\u5f00\u59cb\uff0c\u9010\u4e00\u7d2f\u52a0")),(0,r.kt)("h3",{id:"2-\u81ea\u5b9a\u4e49-partitioner-\u5206\u533a\u903b\u8f91"},"2. \u81ea\u5b9a\u4e49 Partitioner \u5206\u533a\u903b\u8f91\uff1a"),(0,r.kt)("h4",{id:"1-\u81ea\u5b9a\u4e49\u7c7b\u7ee7\u627f-partitioner-\u7c7b\u91cd\u5199getpartition\u65b9\u6cd5"},"1. \u81ea\u5b9a\u4e49\u7c7b\u7ee7\u627f Partitioner \u7c7b\uff0c\u91cd\u5199getPartition()\u65b9\u6cd5\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class CustomPartitioner extends Partitioner<Text, FlowBean> {\n\xa0   @Override\n    public int getPartition(Text key, FlowBean value, int numPartitions) {\n\xa0         // \u63a7\u5236\u5206\u533a\u4ee3\u7801\u903b\u8f91\n            \u2026 \u2026\n        return partition;\n    }\n}\n")),(0,r.kt)("h4",{id:"2-\u5728-job-\u9a71\u52a8\u4e2d\u8bbe\u7f6e\u81ea\u5b9a\u4e49-partitioner-\u7c7b"},"2. \u5728 Job \u9a71\u52a8\u4e2d\uff0c\u8bbe\u7f6e\u81ea\u5b9a\u4e49 Partitioner \u7c7b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"job.setPartitionerClass(CustomPartitioner.class);\n")),(0,r.kt)("h4",{id:"3-\u8981\u6839\u636e\u81ea\u5b9a\u4e49-partitioner-\u7684\u903b\u8f91\u8bbe\u7f6e\u76f8\u5e94\u6570\u91cf\u7684-reducetask"},"3. \u8981\u6839\u636e\u81ea\u5b9a\u4e49 Partitioner \u7684\u903b\u8f91\u8bbe\u7f6e\u76f8\u5e94\u6570\u91cf\u7684 ReduceTask\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"job.setNumReduceTasks(5); // \u5f005\u4e2a ReduceTask\n")),(0,r.kt)("h2",{id:"2-writablecomparable-\u6392\u5e8f"},"2. WritableComparable \u6392\u5e8f\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u6392\u5e8f\u662fMapReduce\u6846\u67b6\u4e2d\u6700\u91cd\u8981\u7684\u64cd\u4f5c\u4e4b\u4e00")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"MapTask \u548c ReduceTask \u5747\u4f1a\u5bf9\u6570\u636e\u6309\u7167 key \u8fdb\u884c\u6392\u5e8f\u3002\u8be5\u64cd\u4f5c\u5c5e\u4e8e Hadoop \u7684",(0,r.kt)("strong",{parentName:"p"},"\u9ed8\u8ba4\u884c\u4e3a"),"\u3002\u4efb\u4f55\u5e94\u7528\u7a0b\u5e8f\u4e2d\u7684\u6570\u636e\u5747\u4f1a\u88ab\u6392\u5e8f\uff0c\u800c\u4e0d\u7ba1\u903b\u8f91\u4e0a\u662f\u5426\u9700\u8981\uff08\u4e3a\u4e86\u5feb\u901f \u5bfc\u5165 ",(0,r.kt)("strong",{parentName:"p"},"Reduce"),"\uff09\u3002")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"\u9ed8\u8ba4\u6392\u5e8f\u662f\u6309\u7167 ",(0,r.kt)("strong",{parentName:"p"},"\u5b57\u5178\u987a\u5e8f\u6392\u5e8f"),"\uff0c\u4e14\u5b9e\u73b0\u8be5\u6392\u5e8f\u7684\u65b9\u6cd5\u662f ",(0,r.kt)("strong",{parentName:"p"},"\u5feb\u901f\u6392\u5e8f"),"\u3002"))),(0,r.kt)("h3",{id:"1-maptask"},"1. MapTask\uff1a"),(0,r.kt)("p",null,"\u5b83\u4f1a\u5c06\u5904\u7406\u7684\u7ed3\u679c\u6682\u65f6\u653e\u5230\u73af\u5f62\u7f13\u51b2\u533a\u4e2d\uff0c",(0,r.kt)("strong",{parentName:"p"},"\u5f53\u73af\u5f62\u7f13\u51b2\u533a\u4f7f\u7528\u7387\u8fbe\u5230\u4e00\u5b9a\u9608\u503c\u540e\uff0c\u518d\u5bf9\u7f13\u51b2\u533a\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u4e00\u6b21\u5feb\u901f\u6392\u5e8f\uff08\u5728\u5185\u5b58\u4e2d\u6392\u5e8f\uff09"),"\uff0c\u5e76\u5c06\u8fd9\u4e9b\u6709\u5e8f\u6570\u636e\u6ea2\u5199\u5230\u78c1\u76d8\u4e0a\uff0c\u800c\u5f53\u6570\u636e\u5904\u7406\u5b8c\u6bd5\u540e\uff0c\u5b83\u4f1a",(0,r.kt)("strong",{parentName:"p"},"\u5bf9\u78c1\u76d8\u4e0a\u6240\u6709\u6587\u4ef6\u8fdb\u884c\u5f52\u5e76\u6392\u5e8f")),(0,r.kt)("h3",{id:"2-reducetask"},"2. ReduceTask\uff1a"),(0,r.kt)("p",null,"\u5b83\u4ece\u6bcf\u4e2aMapTask\u4e0a\u8fdc\u7a0b\u62f7\u8d1d\u76f8\u5e94\u7684\u6570\u636e\u6587\u4ef6\uff0c",(0,r.kt)("strong",{parentName:"p"},"\u5982\u679c\u6587\u4ef6\u5927\u5c0f\u8d85\u8fc7\u4e00\u5b9a\u9608\u503c\uff0c\u5219\u6ea2\u5199\u78c1\u76d8\u4e0a\uff0c\u5426\u5219\u5b58\u50a8\u5728\u5185\u5b58\u4e2d"),"\u3002\u5982\u679c\u78c1\u76d8\u4e0a\u6587\u4ef6\u6570\u76ee\u8fbe\u5230\u4e00\u5b9a\u9608\u503c\uff0c\u5219\u8fdb\u884c\u4e00\u6b21\u5f52\u5e76\u6392\u5e8f\u4ee5\u751f\u6210\u4e00\u4e2a\u66f4\u5927\u6587\u4ef6\uff1b\u5982\u679c\u5185\u5b58\u4e2d\u6587\u4ef6\u5927\u5c0f\u6216\u8005\u6570\u76ee\u8d85\u8fc7\u4e00\u5b9a\u9608\u503c\uff0c\u5219\u8fdb\u884c\u4e00\u6b21\u5408\u5e76\u540e\u5c06\u6570\u636e\u6ea2\u5199\u5230\u78c1\u76d8\u4e0a\u3002\u5f53\u6240\u6709\u6570\u636e\u62f7\u8d1d\u5b8c\u6bd5\u540e\uff0c",(0,r.kt)("strong",{parentName:"p"},"ReduceTask\u7edf\u4e00\u5bf9\u5185\u5b58\u548c\u78c1\u76d8\u4e0a\u7684\u6240\u6709\u6570\u636e\u8fdb\u884c\u4e00\u6b21\u5f52\u5e76\u6392\u5e8f")),(0,r.kt)("h2",{id:"3-combiner-\u5408\u5e76"},"3. Combiner \u5408\u5e76\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Combiner \u662f MR\u7a0b\u5e8f\u4e2d Mapper \u548c Reducer \u4e4b\u5916\u7684\u4e00\u79cd\u7ec4\u4ef6"),(0,r.kt)("li",{parentName:"ol"},"Combiner \u7ec4\u4ef6\u7684\u7236\u7c7b\u5c31\u662f ",(0,r.kt)("strong",{parentName:"li"},"Reducer")),(0,r.kt)("li",{parentName:"ol"},"Combiner \u548c Reducer \u7684\u533a\u522b\u5728\u4e8e\u8fd0\u884c\u7684\u4f4d\u7f6e\uff1a",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Combiner\u662f\u5728 ",(0,r.kt)("strong",{parentName:"li"},"\u6bcf\u4e00\u4e2a")," ",(0,r.kt)("strong",{parentName:"li"},"MapTask\u6240\u5728\u7684\u8282\u70b9")," \u8fd0\u884c"),(0,r.kt)("li",{parentName:"ol"},"Reducer \u662f\u63a5\u6536",(0,r.kt)("strong",{parentName:"li"},"\u5168\u5c40"),"\u6240\u6709 Mapper \u7684\u8f93\u51fa\u7ed3\u679c"))),(0,r.kt)("li",{parentName:"ol"},"Combiner\u7684\u610f\u4e49\u5c31\u662f\u5bf9\u6bcf\u4e00\u4e2aMapTask\u7684\u8f93\u51fa\u8fdb\u884c\u5c40\u90e8\u6c47\u603b\uff0c\u4ee5",(0,r.kt)("strong",{parentName:"li"},"\u51cf\u5c0f\u7f51\u7edc\u4f20\u8f93\u91cf")),(0,r.kt)("li",{parentName:"ol"},"Combiner\u80fd\u591f\u5e94\u7528\u7684\u524d\u63d0\u662f",(0,r.kt)("strong",{parentName:"li"},"\u4e0d\u80fd\u5f71\u54cd\u6700\u7ec8\u7684\u4e1a\u52a1\u903b\u8f91"),"\uff0c\u800c\u4e14\uff0cCombiner\u7684\u8f93\u51fakv \u5e94\u8be5\u8ddfReducer\u7684\u8f93\u5165kv \u7c7b\u578b\u8981\u5bf9\u5e94\u8d77\u6765")),(0,r.kt)("h2",{id:"4-\u5b9e\u6218\u6848\u4f8b"},"4. \u5b9e\u6218\u6848\u4f8b\uff1a"),(0,r.kt)("h3",{id:"1-partitioner-\u5206\u533a\u53ea\u5199\u6dfb\u52a0\u90e8\u5206-\u5176\u4ed6\u5728\u4e0a\u4e00\u8282\u67e5\u627e"},"1. Partitioner \u5206\u533a\uff08\u53ea\u5199\u6dfb\u52a0\u90e8\u5206 \u5176\u4ed6\u5728\u4e0a\u4e00\u8282\u67e5\u627e\uff09\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u5206\u533a\u7c7b\u5199\u6cd5\uff1a")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'package com.jelllyrain.mapreduce.partitioner;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Partitioner;\n\npublic class ProvincePartitioner extends Partitioner<Text, FlowBean> {\n\n    @Override\n    public int getPartition(Text text, FlowBean flowBean, int numPartitions) {\n        //\u83b7\u53d6\u624b\u673a\u53f7\u524d\u4e09\u4f4dprePhone\n        String phone = text.toString();\n        String prePhone = phone.substring(0, 3);\n\n        //\u5b9a\u4e49\u4e00\u4e2a\u5206\u533a\u53f7\u53d8\u91cfpartition,\u6839\u636eprePhone\u8bbe\u7f6e\u5206\u533a\u53f7\n        int partition;\n\n        if("136".equals(prePhone)){\n            partition = 0;\n        }else if("137".equals(prePhone)){\n            partition = 1;\n        }else if("138".equals(prePhone)){\n            partition = 2;\n        }else if("139".equals(prePhone)){\n            partition = 3;\n        }else {\n            partition = 4;\n        }\n\n        //\u6700\u540e\u8fd4\u56de\u5206\u533a\u53f7partition\n        return partition;\n    }\n}\n')),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"\u5728\u9a71\u52a8\u51fd\u6570\u4e2d\u589e\u52a0\u81ea\u5b9a\u4e49\u6570\u636e\u5206\u533a\u8bbe\u7f6e\u548cReduceTask\u8bbe\u7f6e\uff08\u65b0\u7248 Driver \u6587\u4ef6\uff09\uff1a")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'package com.jelllyrain.mapreduce.partitioner;\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Job;\nimport org.apache.hadoop.mapreduce.lib.input.FileInputFormat;\nimport org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;\nimport java.io.IOException;\n\npublic class FlowDriver {\n\n    public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException {\n\n        //1 \u83b7\u53d6job\u5bf9\u8c61\n        Configuration conf = new Configuration();\n        Job job = Job.getInstance(conf);\n\n        //2 \u5173\u8054\u672cDriver\u7c7b\n        job.setJarByClass(FlowDriver.class);\n\n        //3 \u5173\u8054Mapper\u548cReducer\n        job.setMapperClass(FlowMapper.class);\n        job.setReducerClass(FlowReducer.class);\n\n        //4 \u8bbe\u7f6eMap\u7aef\u8f93\u51fa\u6570\u636e\u7684KV\u7c7b\u578b\n        job.setMapOutputKeyClass(Text.class);\n        job.setMapOutputValueClass(FlowBean.class);\n\n        //5 \u8bbe\u7f6e\u7a0b\u5e8f\u6700\u7ec8\u8f93\u51fa\u7684KV\u7c7b\u578b\n        job.setOutputKeyClass(Text.class);\n        job.setOutputValueClass(FlowBean.class);\n\n        //8 \u6307\u5b9a\u81ea\u5b9a\u4e49\u5206\u533a\u5668\uff08\u65b0\u6dfb\u52a0\uff09\n        job.setPartitionerClass(ProvincePartitioner.class);\n\n        //9 \u540c\u65f6\u6307\u5b9a\u76f8\u5e94\u6570\u91cf\u7684ReduceTask\uff08\u65b0\u6dfb\u52a0\uff09\n        job.setNumReduceTasks(5);\n\n        //6 \u8bbe\u7f6e\u8f93\u5165\u8f93\u51fa\u8def\u5f84\n        FileInputFormat.setInputPaths(job, new Path("D:\\\\inputflow"));\n        FileOutputFormat.setOutputPath(job, new Path("D\\\\partitionout"));\n\n        //7 \u63d0\u4ea4Job\n        boolean b = job.waitForCompletion(true);\n        System.exit(b ? 0 : 1);\n    }\n}\n')),(0,r.kt)("h3",{id:"2-writablecomparable-\u6392\u5e8f\u533a\u5185\u6392\u5e8f"},"2. WritableComparable \u6392\u5e8f\uff08\u533a\u5185\u6392\u5e8f\uff09\uff1a"),(0,r.kt)("h4",{id:"1-\u9700\u6c42"},"1. \u9700\u6c42\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u8f93\u5165\u6570\u636e\uff1a")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"1   13736230513 192.196.100.1   www.atguigu.com 2481    24681   200\n2   13846544121 192.196.100.2           264 0   200\n3   13956435636 192.196.100.3           132 1512    200\n4   13966251146 192.168.100.1           240 0   404\n5   18271575951 192.168.100.2   www.atguigu.com 1527    2106    200\n6   84188413    192.168.100.3   www.atguigu.com 4116    1432    200\n7   13590439668 192.168.100.4           1116    954 200\n8   15910133277 192.168.100.5   www.hao123.com  3156    2936    200\n9   13729199489 192.168.100.6           240 0   200\n10  13630577991 192.168.100.7   www.shouhu.com  6960    690 200\n11  15043685818 192.168.100.8   www.baidu.com   3659    3538    200\n12  15959002129 192.168.100.9   www.atguigu.com 1938    180 500\n13  13560439638 192.168.100.10          918 4938    200\n14  13470253144 192.168.100.11          180 180 200\n15  13682846555 192.168.100.12  www.qq.com  1938    2910    200\n16  13992314666 192.168.100.13  www.gaga.com    3008    3720    200\n17  13509468723 192.168.100.14  www.qinghua.com 7335    110349  404\n18  18390173782 192.168.100.15  www.sogou.com   9531    2412    200\n19  13975057813 192.168.100.16  www.baidu.com   11058   48243   200\n20  13768778790 192.168.100.17          120 120 200\n21  13568436656 192.168.100.18  www.alibaba.com 2481    24681   200\n22  13568436656 192.168.100.19          1116    954 200\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"\u8f93\u51fa\u6570\u636e\uff1a")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"13509468723 7335    110349  117684\n13736230513 2481    24681   27162\n13956435636 132     1512    1644\n13846544121 264     0       264\n\u3002\u3002\u3002 \u3002\u3002\u3002\n")),(0,r.kt)("h4",{id:"2-\u5b9e\u73b0"},"2. \u5b9e\u73b0\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"FlowBean \u5bf9\u8c61 \u6362\u6210\u7ee7\u627f WritableComparable\uff1a")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'package com.jellyrain.mapreduce.writablecompable;\n\nimport org.apache.hadoop.io.WritableComparable;\nimport java.io.DataInput;\nimport java.io.DataOutput;\nimport java.io.IOException;\n\npublic class FlowBean implements WritableComparable<FlowBean> {\n\n    private long upFlow; //\u4e0a\u884c\u6d41\u91cf\n    private long downFlow; //\u4e0b\u884c\u6d41\u91cf\n    private long sumFlow; //\u603b\u6d41\u91cf\n\n    //\u63d0\u4f9b\u65e0\u53c2\u6784\u9020\n    public FlowBean() {\n    }\n\n    //\u751f\u6210\u4e09\u4e2a\u5c5e\u6027\u7684getter\u548csetter\u65b9\u6cd5\n    public long getUpFlow() {\n        return upFlow;\n    }\n\n    public void setUpFlow(long upFlow) {\n        this.upFlow = upFlow;\n    }\n\n    public long getDownFlow() {\n        return downFlow;\n    }\n\n    public void setDownFlow(long downFlow) {\n        this.downFlow = downFlow;\n    }\n\n    public long getSumFlow() {\n        return sumFlow;\n    }\n\n    public void setSumFlow(long sumFlow) {\n        this.sumFlow = sumFlow;\n    }\n\n    public void setSumFlow() {\n        this.sumFlow = this.upFlow + this.downFlow;\n    }\n\n    //\u5b9e\u73b0\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u65b9\u6cd5,\u6ce8\u610f\u987a\u5e8f\u4e00\u5b9a\u8981\u4e00\u81f4\n    @Override\n    public void write(DataOutput out) throws IOException {\n        out.writeLong(this.upFlow);\n        out.writeLong(this.downFlow);\n        out.writeLong(this.sumFlow);\n\n    }\n\n    @Override\n    public void readFields(DataInput in) throws IOException {\n        this.upFlow = in.readLong();\n        this.downFlow = in.readLong();\n        this.sumFlow = in.readLong();\n    }\n\n    //\u91cd\u5199ToString,\u6700\u540e\u8981\u8f93\u51faFlowBean\n    @Override\n    public String toString() {\n        return upFlow + "\\t" + downFlow + "\\t" + sumFlow;\n    }\n\n    @Override // \u6392\u5e8f\u6838\u5fc3\u4ee3\u7801 \u91cd\u5199 compareTo\n    public int compareTo(FlowBean o) {\n\n        //\u6309\u7167\u603b\u6d41\u91cf\u6bd4\u8f83,\u5012\u5e8f\u6392\u5217\n        if(this.sumFlow > o.sumFlow){\n            return -1;\n        }else if(this.sumFlow < o.sumFlow){\n            return 1;\n        }else {\n            return 0;\n        }\n    }\n}\n')),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"\u7f16\u5199 ",(0,r.kt)("strong",{parentName:"li"},"Mapper")," \u7c7b\uff1a")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'package com.jellyrain.mapreduce.writablecompable;\n\nimport org.apache.hadoop.io.LongWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Mapper;\nimport java.io.IOException;\n\npublic class FlowMapper extends Mapper<LongWritable, Text, FlowBean, Text> {\n    private FlowBean outK = new FlowBean();\n    private Text outV = new Text();\n\n    @Override\n    protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException {\n\n        //1 \u83b7\u53d6\u4e00\u884c\u6570\u636e\n        String line = value.toString();\n\n        //2 \u6309\u7167"\\t",\u5207\u5272\u6570\u636e\n        String[] split = line.split("\\t");\n\n        //3 \u5c01\u88c5outK outV\n        outK.setUpFlow(Long.parseLong(split[1]));\n        outK.setDownFlow(Long.parseLong(split[2]));\n        outK.setSumFlow();\n        outV.set(split[0]);\n\n        //4 \u5199\u51faoutK outV\n        context.write(outK,outV);\n    }\n}\n')),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"\u7f16\u5199 ",(0,r.kt)("strong",{parentName:"li"},"Reducer")," \u7c7b\uff1a")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"package com.jellyrain.mapreduce.writablecompable;\n\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Reducer;\nimport java.io.IOException;\n\npublic class FlowReducer extends Reducer<FlowBean, Text, Text, FlowBean> {\n    @Override\n    protected void reduce(FlowBean key, Iterable<Text> values, Context context) throws IOException, InterruptedException {\n\n        //\u904d\u5386values\u96c6\u5408,\u5faa\u73af\u5199\u51fa,\u907f\u514d\u603b\u6d41\u91cf\u76f8\u540c\u7684\u60c5\u51b5\n        for (Text value : values) {\n            //\u8c03\u6362KV\u4f4d\u7f6e,\u53cd\u5411\u5199\u51fa\n            context.write(value,key);\n        }\n    }\n}\n")),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"\u7f16\u5199 ",(0,r.kt)("strong",{parentName:"li"},"Driver")," \u7c7b\uff1a")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'package com.jellyrain.mapreduce.writablecompable;\n\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Job;\nimport org.apache.hadoop.mapreduce.lib.input.FileInputFormat;\nimport org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;\nimport java.io.IOException;\n\npublic class FlowDriver {\n\n    public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException {\n\n        //1 \u83b7\u53d6job\u5bf9\u8c61\n        Configuration conf = new Configuration();\n        Job job = Job.getInstance(conf);\n\n        //2 \u5173\u8054\u672cDriver\u7c7b\n        job.setJarByClass(FlowDriver.class);\n\n        //3 \u5173\u8054Mapper\u548cReducer\n        job.setMapperClass(FlowMapper.class);\n        job.setReducerClass(FlowReducer.class);\n\n        //4 \u8bbe\u7f6eMap\u7aef\u8f93\u51fa\u6570\u636e\u7684KV\u7c7b\u578b\uff08\u7531\u4e8e\u4f7f\u7528FlowBean\u6392\u5e8f\uff0c\u4e14\u53ea\u80fd\u662fkey\u6392\u5e8f\uff0c\u6240\u4ee5\u548c\u4ee5\u524d\u7684\u987a\u5e8f\u76f8\u53cd\uff09\n        job.setMapOutputKeyClass(FlowBean.class);\n        job.setMapOutputValueClass(Text.class);\n\n        //5 \u8bbe\u7f6e\u7a0b\u5e8f\u6700\u7ec8\u8f93\u51fa\u7684KV\u7c7b\u578b\n        job.setOutputKeyClass(Text.class);\n        job.setOutputValueClass(FlowBean.class);\n\n        //6 \u8bbe\u7f6e\u8f93\u5165\u8f93\u51fa\u8def\u5f84\n        FileInputFormat.setInputPaths(job, new Path("D:\\\\inputflow2"));\n        FileOutputFormat.setOutputPath(job, new Path("D:\\\\comparout"));\n\n        //7 \u63d0\u4ea4Job\n        boolean b = job.waitForCompletion(true);\n        System.exit(b ? 0 : 1);\n    }\n}\n')),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},"\u533a\u5185\u6392\u5e8f\uff1a")),(0,r.kt)("p",null,"\u53c2\u8003 ",(0,r.kt)("strong",{parentName:"p"},"Partitioner \u5206\u533a")," \u6848\u4f8b\uff0c\u7f16\u5199\uff0c\u6cdb\u578b\u662f ",(0,r.kt)("inlineCode",{parentName:"p"},"FlowBean, Text")," \uff08\u7531\u4e8e\u4f7f\u7528FlowBean\u6392\u5e8f\uff0c\u4e14\u53ea\u80fd\u662fkey\u6392\u5e8f\uff0c\u6240\u4ee5\u548c\u4ee5\u524d\u7684\u987a\u5e8f\u76f8\u53cd\uff09"),(0,r.kt)("h3",{id:"3-combiner-\u5408\u5e76\u53ea\u5199\u6dfb\u52a0\u90e8\u5206-\u5176\u4ed6\u5728\u4e0a\u4e00\u8282\u67e5\u627e"},"3. Combiner \u5408\u5e76\uff08\u53ea\u5199\u6dfb\u52a0\u90e8\u5206 \u5176\u4ed6\u5728\u4e0a\u4e00\u8282\u67e5\u627e\uff09\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u589e\u52a0\u4e00\u4e2a WordCountCombiner \u7c7b\u7ee7\u627f Reducer\uff1a")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"package com.jellyrain.mapreduce.combiner;\n\nimport org.apache.hadoop.io.IntWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Reducer;\nimport java.io.IOException;\n\npublic class WordCountCombiner extends Reducer<Text, IntWritable, Text, IntWritable> {\n\nprivate IntWritable outV = new IntWritable();\n\n    @Override\n    protected void reduce(Text key, Iterable<IntWritable> values, Context context) throws IOException, InterruptedException {\n\n        int sum = 0;\n        for (IntWritable value : values) {\n            sum += value.get();\n        }\n\n        //\u5c01\u88c5outKV\n        outV.set(sum);\n\n        //\u5199\u51faoutKV\n        context.write(key,outV);\n    }\n}\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"\u5728 WordcountDriver \u9a71\u52a8\u7c7b\u4e2d\u6307\u5b9a Combiner\uff1a")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"// \u6307\u5b9a\u9700\u8981\u4f7f\u7528combiner\uff0c\u4ee5\u53ca\u7528\u54ea\u4e2a\u7c7b\u4f5c\u4e3acombiner\u7684\u903b\u8f91\njob.setCombinerClass(WordCountCombiner.class);\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"\u6216\u8005")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u5c06 ",(0,r.kt)("strong",{parentName:"li"},"WordcountReducer")," \u4f5c\u4e3a ",(0,r.kt)("strong",{parentName:"li"},"Combiner")," \u5728 ",(0,r.kt)("strong",{parentName:"li"},"WordcountDriver")," \u9a71\u52a8\u7c7b\u4e2d\u6307\u5b9a\uff1a")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"// \u6307\u5b9a\u9700\u8981\u4f7f\u7528combiner\uff0c\u4ee5\u53ca\u7528\u54ea\u4e2a\u7c7b\u4f5c\u4e3acombiner\u7684\u903b\u8f91\njob.setCombinerClass(WordCountReducer.class);\n")))}d.isMDXComponent=!0},59575:function(e,t,n){t.Z=n.p+"assets/images/Snipaste_2022-04-22_14-22-48-aa9a3658ae5958b25b6f336f4e392806.png"},2043:function(e,t,n){t.Z=n.p+"assets/images/Snipaste_2022-04-22_14-45-50-340a650278da3d9b0c963c41fc85bea4.png"}}]);