"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2306],{3905:function(e,n,t){t.d(n,{Zo:function(){return c},kt:function(){return m}});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function p(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=a.createContext({}),u=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):p(p({},n),e)),t},c=function(e){var n=u(e.components);return a.createElement(l.Provider,{value:n},e.children)},s={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=u(t),m=r,g=d["".concat(l,".").concat(m)]||d[m]||s[m]||o;return t?a.createElement(g,p(p({ref:n},c),{},{components:t})):a.createElement(g,p({ref:n},c))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,p=new Array(o);p[0]=d;var i={};for(var l in n)hasOwnProperty.call(n,l)&&(i[l]=n[l]);i.originalType=e,i.mdxType="string"==typeof e?e:r,p[1]=i;for(var u=2;u<o;u++)p[u]=t[u];return a.createElement.apply(null,p)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},67890:function(e,n,t){t.r(n),t.d(n,{assets:function(){return c},contentTitle:function(){return l},default:function(){return m},frontMatter:function(){return i},metadata:function(){return u},toc:function(){return s}});var a=t(83117),r=t(80102),o=(t(67294),t(3905)),p=["components"],i={sidebar_position:9},l=void 0,u={unversionedId:"Hadoop/MapReduce/Join\u5e94\u7528",id:"Hadoop/MapReduce/Join\u5e94\u7528",title:"Join\u5e94\u7528",description:"1. Reduce Join\uff1a",source:"@site/docs\\8-Hadoop\\6-MapReduce\\Join\u5e94\u7528.md",sourceDirName:"8-Hadoop/6-MapReduce",slug:"/Hadoop/MapReduce/Join\u5e94\u7528",permalink:"/learn/Hadoop/MapReduce/Join\u5e94\u7528",draft:!1,tags:[],version:"current",sidebarPosition:9,frontMatter:{sidebar_position:9},sidebar:"tutorialSidebar",previous:{title:"MapReduce\u5185\u6838\u89e3\u6790",permalink:"/learn/Hadoop/MapReduce/MapReduce\u5185\u6838\u89e3\u6790"},next:{title:"MapReduce ETL\u7528\u6cd5",permalink:"/learn/Hadoop/MapReduce/MapReduce ETL\u7528\u6cd5"}},c={},s=[{value:"1. Reduce Join\uff1a",id:"1-reduce-join",level:2},{value:"2. \u6570\u636e\u503e\u659c\uff1a",id:"2-\u6570\u636e\u503e\u659c",level:2},{value:"3. Map Join\uff1a",id:"3-map-join",level:2},{value:"4. \u5b9e\u6218\u6848\u4f8b\uff1a",id:"4-\u5b9e\u6218\u6848\u4f8b",level:2},{value:"1. Reduce Join\uff1a",id:"1-reduce-join-1",level:3},{value:"2. Map Join\uff1a",id:"2-map-join",level:3}],d={toc:s};function m(e){var n=e.components,i=(0,r.Z)(e,p);return(0,o.kt)("wrapper",(0,a.Z)({},d,i,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"1-reduce-join"},"1. Reduce Join\uff1a"),(0,o.kt)("p",null,"\u200b\tMap\u7aef\u7684\u4e3b\u8981\u5de5\u4f5c\uff1a\u4e3a\u6765\u81ea\u4e0d\u540c\u8868\u6216\u6587\u4ef6\u7684key/value\u5bf9\uff0c",(0,o.kt)("strong",{parentName:"p"},"\u6253\u6807\u7b7e\u4ee5\u533a\u522b\u4e0d\u540c\u6765\u6e90\u7684\u8bb0\u5f55"),"\u3002\u7136\u540e",(0,o.kt)("strong",{parentName:"p"},"\u7528\u8fde\u63a5\u5b57\u6bb5\u4f5c\u4e3akey"),"\uff0c\u5176\u4f59\u90e8\u5206\u548c\u65b0\u52a0\u7684\u6807\u5fd7\u4f5c\u4e3avalue\uff0c\u6700\u540e\u8fdb\u884c\u8f93\u51fa\u3002"),(0,o.kt)("p",null,"  Reduce\u7aef\u7684\u4e3b\u8981\u5de5\u4f5c\uff1a\u5728Reduce\u7aef",(0,o.kt)("strong",{parentName:"p"},"\u4ee5\u8fde\u63a5\u5b57\u6bb5\u4f5c\u4e3akey\u7684\u5206\u7ec4\u5df2\u7ecf\u5b8c\u6210"),"\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5728\u6bcf\u4e00\u4e2a\u5206\u7ec4\u5f53\u4e2d\u5c06\u90a3\u4e9b\u6765\u6e90\u4e8e\u4e0d\u540c\u6587\u4ef6\u7684\u8bb0\u5f55\uff08\u5728Map\u9636\u6bb5\u5df2\u7ecf\u6253\u6807\u5fd7\uff09\u5206\u5f00\uff0c\u6700\u540e\u8fdb\u884c\u5408\u5e76\u5c31ok\u4e86"),(0,o.kt)("p",null,"\u200b\t",(0,o.kt)("strong",{parentName:"p"},"\u5f88\u53ef\u80fd\u4f1a\u51fa\u73b0 \u6570\u636e\u503e\u659c")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u7f3a\u70b9\uff1a")),(0,o.kt)("p",null,"\u200b\t\u8fd9\u79cd\u65b9\u5f0f\u4e2d\uff0c",(0,o.kt)("strong",{parentName:"p"},"\u5408\u5e76\u7684\u64cd\u4f5c\u662f\u5728Reduce\u9636\u6bb5\u5b8c\u6210"),"\uff0cReduce\u7aef\u7684\u5904\u7406\u538b\u529b\u592a\u5927\uff0cMap\u8282\u70b9\u7684\u8fd0\u7b97\u8d1f\u8f7d\u5219\u5f88\u4f4e\uff0c\u8d44\u6e90\u5229\u7528\u7387\u4e0d\u9ad8\uff0c\u4e14\u5728Reduce\u9636\u6bb5\u6781\u6613\u4ea7\u751f\u6570\u636e\u503e\u659c"),(0,o.kt)("h2",{id:"2-\u6570\u636e\u503e\u659c"},"2. \u6570\u636e\u503e\u659c\uff1a"),(0,o.kt)("p",null,"\u6570\u636e\u503e\u659c\u7684\u6839\u672c\u539f\u56e0\u662f\u6570\u636e\u7684key\u5206\u5e03\u4e0d\u5747\uff0c\u4e2a\u522bkey\u6570\u636e\u5f88\u591a\uff0c\u8d85\u51fa\u4e86\u8ba1\u7b97\u8282\u70b9\u7684\u8ba1\u7b97\u80fd\u529b\u7684\u7ed3\u679c"),(0,o.kt)("p",null,"\u8fc7\u7a0b\uff1a\u6570\u636e\u7ecf\u8fc7 map\u540e\uff0c\u7531\u4e8e\u4e0d\u540ckey \u7684\u6570\u636e\u91cf\u5206\u5e03\u4e0d\u5747\uff0c\u5728shuffle \u9636\u6bb5\u4e2d\u901a\u8fc7 partition \u5c06\u76f8\u540c\u7684 key \u7684\u6570\u636e\u6253\u4e0a\u53d1\u5f80\u540c\u4e00\u4e2a reducer \u7684\u6807\u8bb0\uff0c\u7136\u540e\u5f00\u59cb spill \uff08\u6ea2\u5199\uff09\u5199\u5165\u78c1\u76d8\uff0c\u6700\u540emerge\u6210\u6700\u7ec8map\u9636\u6bb5\u8f93\u51fa\u6587\u4ef6"),(0,o.kt)("p",null,"\u5982\u6b64\u4e00\u6765 ",(0,o.kt)("strong",{parentName:"p"},"\u6570\u636e\u91cf\u5f88\u5927\u7684key \u5c06\u53d1\u5f80\u540c\u4e00\u4e2a reducer"),"\uff0c",(0,o.kt)("strong",{parentName:"p"},"\u8d85\u51fa\u4e86\u8282\u70b9\u7684\u8ba1\u7b97\u80fd\u529b\uff0c\u7b49\u5f85\u65f6\u95f4\u8d85\u51fa\u4e86\u53ef\u63a5\u53d7\u8303\u56f4")),(0,o.kt)("h2",{id:"3-map-join"},"3. Map Join\uff1a"),(0,o.kt)("p",null,"Map Join\u9002\u7528\u4e8e",(0,o.kt)("strong",{parentName:"p"},"\u4e00\u5f20\u8868\u5341\u5206\u5c0f\u3001\u4e00\u5f20\u8868\u5f88\u5927\u7684\u573a\u666f")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u601d\u8003\uff1a\u5728Reduce\u7aef\u5904\u7406\u8fc7\u591a\u7684\u8868\uff0c\u975e\u5e38\u5bb9\u6613\u4ea7\u751f\u6570\u636e\u503e\u659c\u3002\u600e\u4e48\u529e\uff1f")),(0,o.kt)("p",null,"\u5728Map\u7aef\u7f13\u5b58\u591a\u5f20\u8868\uff0c\u63d0\u524d\u5904\u7406\u4e1a\u52a1\u903b\u8f91\uff0c\u8fd9\u6837\u589e\u52a0Map\u7aef\u4e1a\u52a1\uff0c\u51cf\u5c11Reduce\u7aef\u6570\u636e\u7684\u538b\u529b\uff0c\u5c3d\u53ef\u80fd\u7684\u51cf\u5c11\u6570\u636e\u503e\u659c"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u91c7\u7528DistributedCache\uff1a")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"\u5728Mapper\u7684 ",(0,o.kt)("strong",{parentName:"p"},"setup\u9636\u6bb5"),"\uff0c\u5c06\u6587\u4ef6\u8bfb\u53d6\u5230\u7f13\u5b58\u96c6\u5408\u4e2d")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"\u5728Driver\u9a71\u52a8\u7c7b\u4e2d\u52a0\u8f7d\u7f13\u5b58"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-java"},'//\u7f13\u5b58\u666e\u901a\u6587\u4ef6\u5230Task\u8fd0\u884c\u8282\u70b9\u3002\njob.addCacheFile(new URI("file:///e:/cache/pd.txt"))\n    \n//\u5982\u679c\u662f\u96c6\u7fa4\u8fd0\u884c,\u9700\u8981\u8bbe\u7f6eHDFS\u8def\u5f84\njob.addCacheFile(new URI("hdfs://hadoop102:8020/cache/pd.txt"))\n')))),(0,o.kt)("h2",{id:"4-\u5b9e\u6218\u6848\u4f8b"},"4. \u5b9e\u6218\u6848\u4f8b\uff1a"),(0,o.kt)("h3",{id:"1-reduce-join-1"},"1. Reduce Join\uff1a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u521b\u5efa\u5546\u54c1\u548c\u8ba2\u5355\u5408\u5e76\u540e\u7684 ",(0,o.kt)("strong",{parentName:"li"},"TableBean")," \u7c7b\uff1a")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'package com.jellyrain.mapreduce.reducejoin;\n\nimport org.apache.hadoop.io.Writable;\n\nimport java.io.DataInput;\nimport java.io.DataOutput;\nimport java.io.IOException;\n\npublic class TableBean implements Writable {\n\n    private String id; //\u8ba2\u5355id\n    private String pid; //\u4ea7\u54c1id\n    private int amount; //\u4ea7\u54c1\u6570\u91cf\n    private String pname; //\u4ea7\u54c1\u540d\u79f0\n    private String flag; //\u5224\u65ad\u662forder\u8868\u8fd8\u662fpd\u8868\u7684\u6807\u5fd7\u5b57\u6bb5\n\n    public TableBean() {\n    }\n\n    public String getId() {\n        return id;\n    }\n\n    public void setId(String id) {\n        this.id = id;\n    }\n\n    public String getPid() {\n        return pid;\n    }\n\n    public void setPid(String pid) {\n        this.pid = pid;\n    }\n\n    public int getAmount() {\n        return amount;\n    }\n\n    public void setAmount(int amount) {\n        this.amount = amount;\n    }\n\n    public String getPname() {\n        return pname;\n    }\n\n    public void setPname(String pname) {\n        this.pname = pname;\n    }\n\n    public String getFlag() {\n        return flag;\n    }\n\n    public void setFlag(String flag) {\n        this.flag = flag;\n    }\n\n    @Override\n    public String toString() {\n        return id + "\\t" + pname + "\\t" + amount;\n    }\n\n    @Override\n    public void write(DataOutput out) throws IOException {\n        out.writeUTF(id);\n        out.writeUTF(pid);\n        out.writeInt(amount);\n        out.writeUTF(pname);\n        out.writeUTF(flag);\n    }\n\n    @Override\n    public void readFields(DataInput in) throws IOException {\n        this.id = in.readUTF();\n        this.pid = in.readUTF();\n        this.amount = in.readInt();\n        this.pname = in.readUTF();\n        this.flag = in.readUTF();\n    }\n}\n')),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"\u7f16\u5199 ",(0,o.kt)("strong",{parentName:"li"},"TableMapper")," \u7c7b\uff1a")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'package com.jellyrain.mapreduce.reducejoin;\n\nimport org.apache.hadoop.io.LongWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.InputSplit;\nimport org.apache.hadoop.mapreduce.Mapper;\nimport org.apache.hadoop.mapreduce.lib.input.FileSplit;\n\nimport java.io.IOException;\n\npublic class TableMapper extends Mapper<LongWritable,Text,Text,TableBean> {\n\n    private String filename;\n    private Text outK = new Text();\n    private TableBean outV = new TableBean();\n\n    @Override // setup \u4e00\u4e2a\u6587\u4ef6\u8c03\u7528\u4e00\u6b21\n    protected void setup(Context context) throws IOException, InterruptedException {\n        //\u83b7\u53d6\u5bf9\u5e94\u6587\u4ef6\u540d\u79f0\n        InputSplit split = context.getInputSplit();\n        FileSplit fileSplit = (FileSplit) split;\n        filename = fileSplit.getPath().getName();\n    }\n\n    @Override \n    protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException {\n\n        //\u83b7\u53d6\u4e00\u884c\n        String line = value.toString();\n\n        //\u5224\u65ad\u662f\u54ea\u4e2a\u6587\u4ef6,\u7136\u540e\u9488\u5bf9\u6587\u4ef6\u8fdb\u884c\u4e0d\u540c\u7684\u64cd\u4f5c\n        if(filename.contains("order")){  //\u8ba2\u5355\u8868\u7684\u5904\u7406\n            String[] split = line.split("\\t");\n            //\u5c01\u88c5outK\n            outK.set(split[1]);\n            //\u5c01\u88c5outV\n            outV.setId(split[0]);\n            outV.setPid(split[1]);\n            outV.setAmount(Integer.parseInt(split[2]));\n            outV.setPname("");\n            outV.setFlag("order");\n        }else {                             //\u5546\u54c1\u8868\u7684\u5904\u7406\n            String[] split = line.split("\\t");\n            //\u5c01\u88c5outK\n            outK.set(split[0]);\n            //\u5c01\u88c5outV\n            outV.setId("");\n            outV.setPid(split[0]);\n            outV.setAmount(0);\n            outV.setPname(split[1]);\n            outV.setFlag("pd");\n        }\n\n        //\u5199\u51faKV\n        context.write(outK,outV);\n    }\n}\n')),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"\u7f16\u5199 ",(0,o.kt)("strong",{parentName:"li"},"TableReducer")," \u7c7b\uff1a")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'package com.jellyrain.mapreduce.reducejoin;\n\nimport org.apache.commons.beanutils.BeanUtils;\nimport org.apache.hadoop.io.NullWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Reducer;\n\nimport java.io.IOException;\nimport java.lang.reflect.InvocationTargetException;\nimport java.util.ArrayList;\n\npublic class TableReducer extends Reducer<Text,TableBean,TableBean, NullWritable> {\n\n    @Override\n    protected void reduce(Text key, Iterable<TableBean> values, Context context) throws IOException, InterruptedException {\n        // \u91cd\u70b9\uff0c\u56e0\u4e3a Hadoop \u5bf9java\u8fed\u4ee3\u5668\u6709\u4f18\u5316 \u53ea\u4f1a\u628a\u6700\u540e\u4e00\u4e2a\u503c\u7684\u5730\u5740\u653e\u8fdb\u53bb\uff0c\u56e0\u4e3a\u4f1a\u5730\u5740\u8986\u76d6\n        ArrayList<TableBean> orderBeans = new ArrayList<>();\n        \n        TableBean pdBean = new TableBean();\n\n        for (TableBean value : values) {\n\n            //\u5224\u65ad\u6570\u636e\u6765\u81ea\u54ea\u4e2a\u8868\n            if("order".equals(value.getFlag())){   //\u8ba2\u5355\u8868\n\n                //\u521b\u5efa\u4e00\u4e2a\u4e34\u65f6TableBean\u5bf9\u8c61\u63a5\u6536value\uff08\u91cd\u70b9\uff0c\u56e0\u4e3a Hadoop \u6709\u4f18\u5316\uff09\n                // new \u4e00\u4e2a\u65b0\u5bf9\u8c61 \u518d\u653e\u5230 ArrayList \u91cc\u9762 \u5c31\u6ca1\u6709\u95ee\u9898\u4e86\n                TableBean tmpOrderBean = new TableBean();\n\n                try {\n                    BeanUtils.copyProperties(tmpOrderBean,value);\n                } catch (IllegalAccessException e) {\n                    e.printStackTrace();\n                } catch (InvocationTargetException e) {\n                    e.printStackTrace();\n                }\n\n              //\u5c06\u4e34\u65f6TableBean\u5bf9\u8c61\u6dfb\u52a0\u5230\u96c6\u5408orderBeans\n                orderBeans.add(tmpOrderBean);\n            }else {                                    //\u5546\u54c1\u8868\n                try {\n                    BeanUtils.copyProperties(pdBean,value);\n                } catch (IllegalAccessException e) {\n                    e.printStackTrace();\n                } catch (InvocationTargetException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n\n        //\u904d\u5386\u96c6\u5408orderBeans,\u66ff\u6362\u6389\u6bcf\u4e2aorderBean\u7684pid\u4e3apname,\u7136\u540e\u5199\u51fa\n        for (TableBean orderBean : orderBeans) {\n\n            orderBean.setPname(pdBean.getPname());\n\n           //\u5199\u51fa\u4fee\u6539\u540e\u7684orderBean\u5bf9\u8c61\n            context.write(orderBean,NullWritable.get());\n        }\n    }\n}\n')),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},"\u7f16\u5199 ",(0,o.kt)("strong",{parentName:"li"},"TableDriver")," \u7c7b\uff1a")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'package com.jellyrain.mapreduce.reducejoin;\n\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.NullWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Job;\nimport org.apache.hadoop.mapreduce.lib.input.FileInputFormat;\nimport org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;\n\nimport java.io.IOException;\n\npublic class TableDriver {\n    public static void main(String[] args) throws IOException, ClassNotFoundException, InterruptedException {\n        Job job = Job.getInstance(new Configuration());\n\n        job.setJarByClass(TableDriver.class);\n        job.setMapperClass(TableMapper.class);\n        job.setReducerClass(TableReducer.class);\n\n        job.setMapOutputKeyClass(Text.class);\n        job.setMapOutputValueClass(TableBean.class);\n\n        job.setOutputKeyClass(TableBean.class);\n        job.setOutputValueClass(NullWritable.class);\n\n        FileInputFormat.setInputPaths(job, new Path("D:\\\\input"));\n        FileOutputFormat.setOutputPath(job, new Path("D:\\\\output"));\n\n        boolean b = job.waitForCompletion(true);\n        System.exit(b ? 0 : 1);\n    }\n}\n')),(0,o.kt)("h3",{id:"2-map-join"},"2. Map Join\uff1a"),(0,o.kt)("p",null,(0,o.kt)("img",{src:t(92779).Z,width:"1316",height:"642"})),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u5148\u5728 ",(0,o.kt)("strong",{parentName:"li"},"MapJoinDriver")," \u9a71\u52a8\u7c7b\u4e2d\u6dfb\u52a0\u7f13\u5b58\u6587\u4ef6\uff08\u6b64\u7ed3\u679c\u4e0d\u9700\u8981 ",(0,o.kt)("strong",{parentName:"li"},"Reduce")," \u9636\u6bb5\uff09\uff1a")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'package com.atguigu.mapreduce.mapjoin;\n\nimport org.apache.hadoop.conf.Configuration;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.NullWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Job;\nimport org.apache.hadoop.mapreduce.lib.input.FileInputFormat;\nimport org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;\n\nimport java.io.IOException;\nimport java.net.URI;\nimport java.net.URISyntaxException;\n\npublic class MapJoinDriver {\n\n    public static void main(String[] args) throws IOException, URISyntaxException, ClassNotFoundException, InterruptedException {\n\n        // 1 \u83b7\u53d6job\u4fe1\u606f\n        Configuration conf = new Configuration();\n        Job job = Job.getInstance(conf);\n        // 2 \u8bbe\u7f6e\u52a0\u8f7djar\u5305\u8def\u5f84\n        job.setJarByClass(MapJoinDriver.class);\n        // 3 \u5173\u8054mapper\n        job.setMapperClass(MapJoinMapper.class);\n        // 4 \u8bbe\u7f6eMap\u8f93\u51faKV\u7c7b\u578b\n        job.setMapOutputKeyClass(Text.class);\n        job.setMapOutputValueClass(NullWritable.class);\n        // 5 \u8bbe\u7f6e\u6700\u7ec8\u8f93\u51faKV\u7c7b\u578b\n        job.setOutputKeyClass(Text.class);\n        job.setOutputValueClass(NullWritable.class);\n\n        // \u52a0\u8f7d\u7f13\u5b58\u6570\u636e (\u91cd\u70b9) \u5982\u679c\u9700\u8981\u7f13\u5b58\u591a\u4e2a\u6587\u4ef6 \u5c31\u5199\u591a\u4e2a addCacheFile\n        job.addCacheFile(new URI("file:///D:/input/tablecache/pd.txt"));\n        // Map\u7aefJoin\u7684\u903b\u8f91\u4e0d\u9700\u8981Reduce\u9636\u6bb5\uff0c\u8bbe\u7f6ereduceTask\u6570\u91cf\u4e3a0\n        job.setNumReduceTasks(0);\n\n        // 6 \u8bbe\u7f6e\u8f93\u5165\u8f93\u51fa\u8def\u5f84\n        FileInputFormat.setInputPaths(job, new Path("D:\\\\input"));\n        FileOutputFormat.setOutputPath(job, new Path("D:\\\\output"));\n        // 7 \u63d0\u4ea4\n        boolean b = job.waitForCompletion(true);\n        System.exit(b ? 0 : 1);\n    }\n}\n')),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"\u5728 ",(0,o.kt)("strong",{parentName:"li"},"MapJoinMapper")," \u7c7b\u4e2d\u7684 ",(0,o.kt)("strong",{parentName:"li"},"setup")," \u65b9\u6cd5\u4e2d\u8bfb\u53d6\u7f13\u5b58\u6587\u4ef6\uff1a")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'package com.jellyrain.mapreduce.mapjoin;\n\nimport org.apache.commons.lang.StringUtils;\nimport org.apache.hadoop.fs.FSDataInputStream;\nimport org.apache.hadoop.fs.FileSystem;\nimport org.apache.hadoop.fs.Path;\nimport org.apache.hadoop.io.IOUtils;\nimport org.apache.hadoop.io.LongWritable;\nimport org.apache.hadoop.io.NullWritable;\nimport org.apache.hadoop.io.Text;\nimport org.apache.hadoop.mapreduce.Mapper;\n\nimport java.io.BufferedReader;\nimport java.io.IOException;\nimport java.io.InputStreamReader;\nimport java.net.URI;\nimport java.util.HashMap;\nimport java.util.Map;\n\npublic class MapJoinMapper extends Mapper<LongWritable, Text, Text, NullWritable> {\n\n    private Map<String, String> pdMap = new HashMap<>();\n    private Text text = new Text();\n\n    //\u4efb\u52a1\u5f00\u59cb\u524d\u5c06pd\u6570\u636e\u7f13\u5b58\u8fdbpdMap\n    @Override\n    protected void setup(Context context) throws IOException, InterruptedException {\n\n        //\u901a\u8fc7\u7f13\u5b58\u6587\u4ef6\u5f97\u5230\u5c0f\u8868\u6570\u636epd.txt\n        URI[] cacheFiles = context.getCacheFiles();\n        Path path = new Path(cacheFiles[0]);\n\n        //\u83b7\u53d6\u6587\u4ef6\u7cfb\u7edf\u5bf9\u8c61,\u5e76\u5f00\u6d41\n        FileSystem fs = FileSystem.get(context.getConfiguration());\n        FSDataInputStream fis = fs.open(path);\n\n        //\u901a\u8fc7\u5305\u88c5\u6d41\u8f6c\u6362\u4e3areader,\u65b9\u4fbf\u6309\u884c\u8bfb\u53d6\n        BufferedReader reader = new BufferedReader(new InputStreamReader(fis, "UTF-8"));\n\n        //\u9010\u884c\u8bfb\u53d6\uff0c\u6309\u884c\u5904\u7406\n        String line;\n        while (StringUtils.isNotEmpty(line = reader.readLine())) {\n            //\u5207\u5272\u4e00\u884c    \n            //01    \u5c0f\u7c73\n            String[] split = line.split("\\t");\n            pdMap.put(split[0], split[1]);\n        }\n\n        //\u5173\u6d41\n        IOUtils.closeStream(reader);\n    }\n\n    @Override\n    protected void map(LongWritable key, Text value, Context context) throws IOException, InterruptedException {\n\n        //\u8bfb\u53d6\u5927\u8868\u6570\u636e    \n        //1001  01  1\n        String[] fields = value.toString().split("\\t");\n\n        //\u901a\u8fc7\u5927\u8868\u6bcf\u884c\u6570\u636e\u7684pid,\u53bbpdMap\u91cc\u9762\u53d6\u51fapname\n        String pname = pdMap.get(fields[1]);\n\n        //\u5c06\u5927\u8868\u6bcf\u884c\u6570\u636e\u7684pid\u66ff\u6362\u4e3apname\n        text.set(fields[0] + "\\t" + pname + "\\t" + fields[2]);\n\n        //\u5199\u51fa\n        context.write(text,NullWritable.get());\n    }\n}\n')))}m.isMDXComponent=!0},92779:function(e,n,t){n.Z=t.p+"assets/images/Snipaste_2022-04-24_10-30-05-00beeddd9fa5c895ed53f5752d7b8be2.png"}}]);